"use strict";function flattenUnsubscriptionErrors(r){return r.reduce(function(r,t){return r.concat(t instanceof UnsubscriptionError_1.UnsubscriptionError?t.errors:t)},[])}Object.defineProperty(exports,"__esModule",{value:!0});var isArray_1=require("./util/isArray"),isObject_1=require("./util/isObject"),isFunction_1=require("./util/isFunction"),tryCatch_1=require("./util/tryCatch"),errorObject_1=require("./util/errorObject"),UnsubscriptionError_1=require("./util/UnsubscriptionError"),Subscription=function(){function e(r){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,r&&(this._unsubscribe=r)}var r;return e.prototype.unsubscribe=function(){var r,t=!1;if(!this.closed){var i=this,e=i._parent,s=i._parents,n=i._unsubscribe,o=i._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var c=-1,u=s?s.length:0;e;)e.remove(this),e=++c<u&&s[c]||null;if(isFunction_1.isFunction(n))tryCatch_1.tryCatch(n).call(this)===errorObject_1.errorObject&&(t=!0,r=r||(errorObject_1.errorObject.e instanceof UnsubscriptionError_1.UnsubscriptionError?flattenUnsubscriptionErrors(errorObject_1.errorObject.e.errors):[errorObject_1.errorObject.e]));if(isArray_1.isArray(o))for(c=-1,u=o.length;++c<u;){var b=o[c];if(isObject_1.isObject(b))if(tryCatch_1.tryCatch(b.unsubscribe).call(b)===errorObject_1.errorObject){t=!0,r=r||[];var a=errorObject_1.errorObject.e;a instanceof UnsubscriptionError_1.UnsubscriptionError?r=r.concat(flattenUnsubscriptionErrors(a.errors)):r.push(a)}}if(t)throw new UnsubscriptionError_1.UnsubscriptionError(r)}},e.prototype.add=function(r){if(!r||r===e.EMPTY)return e.EMPTY;if(r===this)return this;var t=r;switch(typeof r){case"function":t=new e(r);case"object":if(t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if("function"!=typeof t._addParent){var i=t;(t=new e)._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(t),t._addParent(this),t},e.prototype.remove=function(r){var t=this._subscriptions;if(t){var i=t.indexOf(r);-1!==i&&t.splice(i,1)}},e.prototype._addParent=function(r){var t=this._parent,i=this._parents;t&&t!==r?i?-1===i.indexOf(r)&&i.push(r):this._parents=[r]:this._parent=r},e.EMPTY=((r=new e).closed=!0,r),e}();exports.Subscription=Subscription;