"use strict";function retryWhen(e){return function(r){return r.lift(new RetryWhenOperator(e,r))}}var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])};return function(r,e){function t(){this.constructor=r}i(r,e),r.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Subject_1=require("../Subject"),tryCatch_1=require("../util/tryCatch"),errorObject_1=require("../util/errorObject"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");exports.retryWhen=retryWhen;var RetryWhenOperator=function(){function r(r,e){this.notifier=r,this.source=e}return r.prototype.call=function(r,e){return e.subscribe(new RetryWhenSubscriber(r,this.notifier,this.source))},r}(),RetryWhenSubscriber=function(s){function r(r,e,t){var i=s.call(this,r)||this;return i.notifier=e,i.source=t,i}return __extends(r,s),r.prototype.error=function(r){if(!this.isStopped){var e=this.errors,t=this.retries,i=this.retriesSubscription;if(t)this.errors=null,this.retriesSubscription=null;else{if(e=new Subject_1.Subject,(t=tryCatch_1.tryCatch(this.notifier)(e))===errorObject_1.errorObject)return s.prototype.error.call(this,errorObject_1.errorObject.e);i=subscribeToResult_1.subscribeToResult(this,t)}this._unsubscribeAndRecycle(),this.errors=e,this.retries=t,this.retriesSubscription=i,e.next(r)}},r.prototype._unsubscribe=function(){var r=this.errors,e=this.retriesSubscription;r&&(r.unsubscribe(),this.errors=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null},r.prototype.notifyNext=function(r,e,t,i,s){var u=this,n=u.errors,o=u.retries,c=u.retriesSubscription;this.errors=null,this.retries=null,this.retriesSubscription=null,this._unsubscribeAndRecycle(),this.errors=n,this.retries=o,this.retriesSubscription=c,this.source.subscribe(this)},r}(OuterSubscriber_1.OuterSubscriber);