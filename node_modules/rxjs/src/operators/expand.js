"use strict";function expand(t,r,i){return void 0===r&&(r=Number.POSITIVE_INFINITY),void 0===i&&(i=void 0),r=(r||0)<1?Number.POSITIVE_INFINITY:r,function(e){return e.lift(new ExpandOperator(t,r,i))}}var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tryCatch_1=require("../util/tryCatch"),errorObject_1=require("../util/errorObject"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");exports.expand=expand;var ExpandOperator=function(){function e(e,t,r){this.project=e,this.concurrent=t,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new ExpandSubscriber(e,this.project,this.concurrent,this.scheduler))},e}();exports.ExpandOperator=ExpandOperator;var ExpandSubscriber=function(o){function n(e,t,r,i){var s=o.call(this,e)||this;return s.project=t,s.concurrent=r,s.scheduler=i,s.index=0,s.active=0,s.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(s.buffer=[]),s}return __extends(n,o),n.dispatch=function(e){var t=e.subscriber,r=e.result,i=e.value,s=e.index;t.subscribeToProjection(r,i,s)},n.prototype._next=function(e){var t=this.destination;if(t.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){t.next(e);var i=tryCatch_1.tryCatch(this.project)(e,r);if(i===errorObject_1.errorObject)t.error(errorObject_1.errorObject.e);else if(this.scheduler){var s={subscriber:this,result:i,value:e,index:r};this.add(this.scheduler.schedule(n.dispatch,0,s))}else this.subscribeToProjection(i,e,r)}else this.buffer.push(e)}},n.prototype.subscribeToProjection=function(e,t,r){this.active++,this.add(subscribeToResult_1.subscribeToResult(this,e,t,r))},n.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete()},n.prototype.notifyNext=function(e,t,r,i,s){this._next(t)},n.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t&&0<t.length&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},n}(OuterSubscriber_1.OuterSubscriber);exports.ExpandSubscriber=ExpandSubscriber;